\section{GUI Implementation}

\subsection{Frameworks}

The most important framework used by GUI is Apache Pivot\footnote{\url{http://pivot.apache.org/}}. As authors say,
Apache Pivot is an open-source platform for building installable Internet applications (IIAs). It is quite new Apache
project, which brings completely new approach to GUI building in Java. The biggest feature of Pivot is totally
decoupled interface description from programming language. The framework uses XML markup from bxml files to build
interfaces. Example of such a file, can be found in Figure~\ref{fig:bxml_example}
 
\begin{figure}[ht]
  \centering
    
\begin{Verbatim}[commandchars=\\\{\},frame=single,framerule=0.2pt]                                                     
\PY{n+nt}{<Window} \PY{n+na}{title=}\PY{l+s}{"Hello BXML!"} \PY{n+na}{maximized=}\PY{l+s}{"true"}                      
    \PY{n+na}{xmlns:bxml=}\PY{l+s}{"http://pivot.apache.org/bxml"}                                                      
    \PY{n+na}{xmlns=}\PY{l+s}{"org.apache.pivot.wtk"}\PY{n+nt}{>}                                                       
    \PY{n+nt}{<Label} \PY{n+na}{text=}\PY{l+s}{"Hello BXML!"}                                                           
        \PY{n+na}{styles=}\PY{l+s}{"\PYZob{}font:'Arial bold 24', color:'#ff0000',}                                     
\PY{l+s}{            horizontalAlignment:'center', verticalAlignment:'center'\PYZcb{}"}\PY{n+nt}{/>}                    
\PY{n+nt}{</Window>}                                                                                                    
\end{Verbatim} 
  \caption{Example of BXML syntax}
  \label{fig:bxml_example}
\end{figure}

Another great feature of Pivot is data binding. Pivot provides own collections which triggers updates of UI state, on
change of collection content. Additionally, it provides means to bind UI items with controller class members. Those
features simplify realization of MVC design pattern a lot. All views in GUI component are implemented using BXML and are
binded to controllers. What is also worth to mention, Pivot allows to easily internationalize application, and
SemSimMon uses it's i18n features - all texts in labels and other UI widgets are internationalized. The default,
English localization has been provided.

Second most important framework in use by GUI is well known Spring
Framework\footnote{\url{http://www.springsource.org}}. Spring is used to integrate all components of this module,
to associate controllers with views and with model. For that purpose spring Inversion of Control Container is
employed\footnote{\url{http://static.springsource.org/spring/docs/3.0.x/reference/beans.html}}

\subsection{Controller infrastructure}

Controllers are most important components in MVC, and thus needs special attention. There are few core mechanisms in
SemSimMon that needs to be understood in order to work with GUI module. 

All controllers inherits from common super class, namely BaseController. This class contains pivot component (view)
that given controller manages, resource (bxml file) that must be used to read and instantiate view and i18n resources. 
It's responsibility is to create component from resource, bind all widgets and button actions. Additionally,
BaseController defines two abstract methods, that can be used for fine tune configuration: \textbf{preDeserialize} and
\textbf{postBinding}. preDeserialize callback is called just after spring initializes controller, all dependencies are
configured, and before BasicController tries to deserialize view. It can be used to initialize resources
needed by deserializer or edit in some way resource that will be used for parsing components. On the other hand,
postBinding is called by BasicController directly after reading view. It can be used to initialize UI components,
populate some data etc.

Binding button's action needs to be describe a bit more as it's quite crucial mechanism in GUI. It was created in
assumption that most actions in GUI applications are triggered user clicking on button (class PushButton in Apache
Pivot). To reduce boilerplate code that needs to be written to handle single action, I've designed ButtonAction
mechanism. It's composed of: BasicController that binds actions to methods, @ButtonAction annotation that can be used
to mark method which should be called on button click, and finally class ReflectionButtonPressListener, which is
responsible for processing given method. Using this mechanism, to handle action request made by user, developer needs
to do three things: define push button with appropriate id in view, define class member of type PushButton and same
name as id defined in view and finally declare method in controller and mark it using @ButtonAction. 

The best way how MVC in SemSimMon works would be by example. Let us assume, that we need basic view composed of one
panel with single label and button. On button click, label gets filed with random content. First thing that needs to be
done, is to define view using BXML. This sample view, can be found in Figure~\ref{fig:sample_view}.

\begin{figure}[ht]
  \centering
    
\begin{Verbatim}[commandchars=\\\{\},frame=single,framerule=0.2pt]                                                    
\PY{c+cp}{<?xml version="1.0"?>}
\PY{n+nt}{<BoxPane} \PY{n+na}{xmlns:bxml=}\PY{l+s}{"http://pivot.apache.org/bxml"}
    \PY{n+na}{xmlns=}\PY{l+s}{"org.apache.pivot.wtk"} \PY{n+na}{orientation=}\PY{l+s}{"vertical"}\PY{n+nt}{>}
  \PY{n+nt}{<Label} \PY{n+na}{bxml:id=}\PY{l+s}{"label"} \PY{n+na}{text=}\PY{l+s}{"%sample.label"}\PY{n+nt}{/>}
  \PY{n+nt}{<PushButton} \PY{n+na}{bxml:id=}\PY{l+s}{"generateButton"}
              \PY{n+na}{buttonData=}\PY{l+s}{"%sample.generate"}\PY{n+nt}{/>}
\PY{n+nt}{</BoxPane>}
\end{Verbatim} 
  \caption{Sample view}
  \label{fig:sample_view}
\end{figure}

This view consist only 3 items: box pane, with vertical orientation, and inside of it: label and push button. What
should be additionally noticed is that texts of label and button are internationalized. In pivot, i18n keys are stored
in json files. Figure~\ref{fig:i18n} 

\begin{figure}[ht]
  \centering
    
\begin{Verbatim}[commandchars=\\\{\},frame=single,framerule=0.2pt]                                                    
\PY{p}{\PYZob{}}
  \PY{l+s+s2}{"sample"} \PY{o}{:} \PY{p}{\PYZob{}}
    \PY{l+s+s2}{"label"} \PY{o}{:} \PY{l+s+s2}{"Sample content of label"}\PY{p}{,}
    \PY{l+s+s2}{"generate"} \PY{o}{:} \PY{l+s+s2}{"Generate text!"}
  \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim} 
  \caption{Sample internationalization bundle}
  \label{fig:i18n}
\end{figure}

Next thing to do, is to create SampleController. It will contain label and button, and 2 handler methods, to show that
one button may trigger multiple methods, which can be called either on UI thread (Event Dispatching Thread) or as a
background task. Figure~\ref{fig:sample_controller} shows listing of SampleController class. 

\pagebreak

\begin{figure}[ht]
  \centering
  \input{cha_impl/SampleController_listing}  
  \caption{Listing of SampleController.java}
  \label{fig:sample_controller}
\end{figure} 

In line 12 of SampleController.java we can see class definition, what should be noticed is that BaseController is
class template and takes class of pivot component as specification parameter. In our case it is BoxPane. Next important
lines are 15-16 and 18-19. Those lines contains declaration of UI widgets that will be binded from view. To define that
given class member should be binded to given UI widget, it must be marked using @BXML annotation and must have name same
as bxml:id of widget. This class defines two handlers that will be triggered after click on generateButton.  

\pagebreak
The lest step is to associate all items using spring xml configuration. Such a configuration can be found in
Figure~\ref{fig:sample_spring}.


\begin{figure}[ht]
  \centering
  \input{cha_impl/spring}  
  \caption{Listing of sample spring configuration}
  \label{fig:sample_spring}
\end{figure}



 